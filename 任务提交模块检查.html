<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»»åŠ¡æäº¤æ¨¡å—æ£€æŸ¥</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .check-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        .check-section h3 {
            margin: 0 0 10px 0;
            color: #333;
        }
        .status-item {
            margin: 5px 0;
            padding: 8px;
            border-radius: 3px;
            font-size: 14px;
        }
        .status-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status-warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .console-output {
            background-color: #1e1e1e;
            color: #ffffff;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            padding: 10px;
            border-radius: 5px;
            height: 200px;
            overflow-y: auto;
            margin: 10px 0;
        }
        .console-line {
            margin: 2px 0;
        }
        .console-error { color: #ff6b6b; }
        .console-warn { color: #ffd93d; }
        .console-info { color: #6bcf7f; }
        .console-log { color: #ffffff; }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        .btn-primary {
            background-color: #007bff;
            color: white;
        }
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ä»»åŠ¡æäº¤æ¨¡å—æ£€æŸ¥å·¥å…·</h1>
        
        <div class="check-section">
            <h3>ç³»ç»ŸçŠ¶æ€æ£€æŸ¥</h3>
            <div id="system-status"></div>
        </div>
        
        <div class="check-section">
            <h3>æ§åˆ¶å°è¾“å‡º</h3>
            <div id="console-output" class="console-output"></div>
        </div>
        
        <div class="check-section">
            <h3>åŠŸèƒ½æµ‹è¯•</h3>
            <button class="btn-primary" onclick="runAllChecks()">è¿è¡Œå…¨é¢æ£€æŸ¥</button>
            <button class="btn-secondary" onclick="testTaskSubmissionModule()">æµ‹è¯•ä»»åŠ¡æäº¤æ¨¡å—</button>
            <button class="btn-secondary" onclick="clearConsole()">æ¸…ç©ºæ§åˆ¶å°</button>
        </div>
        
        <div class="check-section">
            <h3>ä»»åŠ¡æäº¤æ¨¡å—æµ‹è¯•</h3>
            <div id="task-submission-test" style="display: none;">
                <form id="test-form" style="margin: 10px 0;">
                    <div style="margin: 10px 0;">
                        <label>æµ‹è¯•å‘˜å·¥é€‰æ‹©ï¼š</label>
                        <select id="test-employee" style="margin: 5px;">
                            <option value="">è¯·é€‰æ‹©å‘˜å·¥</option>
                        </select>
                    </div>
                    <div style="margin: 10px 0;">
                        <label>æµ‹è¯•ä»»åŠ¡é€‰æ‹©ï¼š</label>
                        <select id="test-task" style="margin: 5px;">
                            <option value="">è¯·é€‰æ‹©ä»»åŠ¡</option>
                        </select>
                    </div>
                    <div style="margin: 10px 0;">
                        <label>æµ‹è¯•è¯´æ˜ï¼š</label>
                        <textarea id="test-note" style="margin: 5px; width: 300px; height: 60px;" placeholder="æµ‹è¯•å®Œæˆè¯´æ˜"></textarea>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="æœªå‘½å.js"></script>
    <script>
        const consoleOutput = document.getElementById('console-output');
        const systemStatus = document.getElementById('system-status');
        
        function addConsoleLine(message, type = 'log') {
            const line = document.createElement('div');
            line.className = `console-line console-${type}`;
            line.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            consoleOutput.appendChild(line);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }
        
        function addStatus(message, type = 'success') {
            const item = document.createElement('div');
            item.className = `status-item status-${type}`;
            item.textContent = message;
            systemStatus.appendChild(item);
        }
        
        function clearConsole() {
            consoleOutput.innerHTML = '';
            addConsoleLine('æ§åˆ¶å°å·²æ¸…ç©º', 'info');
        }
        
        function runAllChecks() {
            systemStatus.innerHTML = '';
            consoleOutput.innerHTML = '';
            
            addConsoleLine('å¼€å§‹å…¨é¢ç³»ç»Ÿæ£€æŸ¥...', 'info');
            
            // æ£€æŸ¥åŸºç¡€ç³»ç»Ÿ
            checkBasicSystem();
            
            // æ£€æŸ¥ä»»åŠ¡æäº¤æ¨¡å—
            setTimeout(() => checkTaskSubmissionModule(), 500);
            
            // æ£€æŸ¥æ•°æ®ç®¡ç†å™¨
            setTimeout(() => checkDataManager(), 1000);
            
            // æ£€æŸ¥é¡µé¢å…ƒç´ 
            setTimeout(() => checkPageElements(), 1500);
            
            addConsoleLine('å…¨é¢æ£€æŸ¥å®Œæˆ', 'info');
        }
        
        function checkBasicSystem() {
            addConsoleLine('æ£€æŸ¥åŸºç¡€ç³»ç»Ÿç»„ä»¶...', 'info');
            
            const components = ['DataManager', 'Renderer', 'EventHandler', 'Statistics', 'PointsStatistics', 'TaskSubmission'];
            
            components.forEach(component => {
                if (typeof window[component] !== 'undefined') {
                    addConsoleLine(`âœ… ${component} å·²å®šä¹‰`, 'success');
                    addStatus(`${component} å·²å®šä¹‰`, 'success');
                } else {
                    addConsoleLine(`âŒ ${component} æœªå®šä¹‰`, 'error');
                    addStatus(`${component} æœªå®šä¹‰`, 'error');
                }
            });
        }
        
        function checkTaskSubmissionModule() {
            addConsoleLine('æ£€æŸ¥ä»»åŠ¡æäº¤æ¨¡å—...', 'info');
            
            if (typeof TaskSubmission === 'undefined') {
                addConsoleLine('âŒ TaskSubmission æœªå®šä¹‰', 'error');
                addStatus('TaskSubmission æœªå®šä¹‰', 'error');
                return;
            }
            
            const methods = ['init', 'bindEvents', 'loadEmployees', 'loadEmployeeTasks', 'handleFileUpload', 'submitTask'];
            
            methods.forEach(method => {
                if (typeof TaskSubmission[method] === 'function') {
                    addConsoleLine(`âœ… TaskSubmission.${method} æ–¹æ³•å­˜åœ¨`, 'success');
                } else {
                    addConsoleLine(`âŒ TaskSubmission.${method} æ–¹æ³•ä¸å­˜åœ¨`, 'error');
                }
            });
            
            // æ£€æŸ¥ä»»åŠ¡æäº¤æ¨¡å—æ˜¯å¦å¯ä»¥åˆå§‹åŒ–
            try {
                addConsoleLine('å°è¯•åˆå§‹åŒ– TaskSubmission...', 'info');
                TaskSubmission.init();
                addConsoleLine('âœ… TaskSubmission åˆå§‹åŒ–æˆåŠŸ', 'success');
                addStatus('TaskSubmission åˆå§‹åŒ–æˆåŠŸ', 'success');
            } catch (error) {
                addConsoleLine(`âŒ TaskSubmission åˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error');
                addStatus(`TaskSubmission åˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        function checkDataManager() {
            addConsoleLine('æ£€æŸ¥æ•°æ®ç®¡ç†å™¨...', 'info');
            
            if (typeof DataManager === 'undefined') {
                addConsoleLine('âŒ DataManager æœªå®šä¹‰', 'error');
                return;
            }
            
            try {
                const employees = DataManager.getEmployees();
                const tasks = DataManager.getTasks();
                
                addConsoleLine(`âœ… å‘˜å·¥æ•°é‡: ${employees.length}`, 'success');
                addConsoleLine(`âœ… ä»»åŠ¡æ•°é‡: ${tasks.length}`, 'success');
                
                if (employees.length > 0) {
                    addConsoleLine(`å‘˜å·¥ç¤ºä¾‹: ${employees[0].name} (${employees[0].department})`, 'info');
                }
                
                if (tasks.length > 0) {
                    addConsoleLine(`ä»»åŠ¡ç¤ºä¾‹: ${tasks[0].name} (çŠ¶æ€: ${tasks[0].status})`, 'info');
                }
                
                addStatus(`æ•°æ®ç®¡ç†å™¨æ­£å¸¸: ${employees.length}å‘˜å·¥, ${tasks.length}ä»»åŠ¡`, 'success');
            } catch (error) {
                addConsoleLine(`âŒ æ•°æ®ç®¡ç†å™¨é”™è¯¯: ${error.message}`, 'error');
                addStatus(`æ•°æ®ç®¡ç†å™¨é”™è¯¯: ${error.message}`, 'error');
            }
        }
        
        function checkPageElements() {
            addConsoleLine('æ£€æŸ¥é¡µé¢å…ƒç´ ...', 'info');
            
            const elements = [
                'task-submission',
                'task-submission-form',
                'submission-employee',
                'submission-task',
                'submission-attachment',
                'submission-note',
                'submission-uploaded-files'
            ];
            
            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    addConsoleLine(`âœ… ${id} å…ƒç´ å­˜åœ¨`, 'success');
                } else {
                    addConsoleLine(`âŒ ${id} å…ƒç´ ä¸å­˜åœ¨`, 'error');
                }
            });
        }
        
        function testTaskSubmissionModule() {
            addConsoleLine('å¼€å§‹æµ‹è¯•ä»»åŠ¡æäº¤æ¨¡å—åŠŸèƒ½...', 'info');
            
            if (typeof TaskSubmission === 'undefined') {
                addConsoleLine('âŒ TaskSubmission æœªå®šä¹‰ï¼Œæ— æ³•æµ‹è¯•', 'error');
                return;
            }
            
            try {
                // æµ‹è¯•åŠ è½½å‘˜å·¥
                addConsoleLine('æµ‹è¯• loadEmployees...', 'info');
                TaskSubmission.loadEmployees();
                addConsoleLine('âœ… loadEmployees æ‰§è¡Œå®Œæˆ', 'success');
                
                // æµ‹è¯•åŠ è½½å‘˜å·¥ä»»åŠ¡
                setTimeout(() => {
                    addConsoleLine('æµ‹è¯• loadEmployeeTasks...', 'info');
                    const employees = DataManager.getEmployees();
                    if (employees.length > 0) {
                        TaskSubmission.loadEmployeeTasks(employees[0].id);
                        addConsoleLine(`âœ… loadEmployeeTasks æ‰§è¡Œå®Œæˆ (å‘˜å·¥: ${employees[0].name})`, 'success');
                    } else {
                        addConsoleLine('âš ï¸ æ²¡æœ‰å‘˜å·¥æ•°æ®ï¼Œæ— æ³•æµ‹è¯• loadEmployeeTasks', 'warn');
                    }
                }, 500);
                
                // æ˜¾ç¤ºæµ‹è¯•è¡¨å•
                document.getElementById('task-submission-test').style.display = 'block';
                addConsoleLine('æµ‹è¯•è¡¨å•å·²æ˜¾ç¤ºï¼Œå¯ä»¥æ‰‹åŠ¨æµ‹è¯•', 'info');
                
            } catch (error) {
                addConsoleLine(`âŒ æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æ£€æŸ¥
        window.addEventListener('load', () => {
            setTimeout(() => {
                addConsoleLine('æ£€æŸ¥å·¥å…·å·²åŠ è½½', 'info');
                runAllChecks();
            }, 1000);
        });
        
        // æ•è·å…¨å±€é”™è¯¯
        window.addEventListener('error', (event) => {
            addConsoleLine(`âŒ å…¨å±€é”™è¯¯: ${event.message} at ${event.filename}:${event.lineno}:${event.colno}`, 'error');
        });
        
        // æ•è·æœªå¤„ç†çš„Promiseæ‹’ç»
        window.addEventListener('unhandledrejection', (event) => {
            addConsoleLine(`âŒ æœªå¤„ç†çš„Promiseæ‹’ç»: ${event.reason}`, 'error');
        });
    </script>
</body>
</html>