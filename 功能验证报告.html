<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»»åŠ¡æäº¤æ¨¡å—åŠŸèƒ½éªŒè¯æŠ¥å‘Š</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .section { background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .test-result { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .code { background: #f8f9fa; padding: 10px; border-radius: 5px; font-family: 'Courier New', monospace; font-size: 14px; margin: 10px 0; }
        .test-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .test-card { background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #dee2e6; }
        .test-card h4 { margin-top: 0; color: #495057; }
        .test-card ul { margin: 10px 0; padding-left: 20px; }
        .test-card li { margin: 5px 0; }
        button { padding: 10px 20px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; background: #007bff; color: white; }
        button:hover { background: #0056b3; }
        .summary { font-size: 18px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ä»»åŠ¡æäº¤æ¨¡å—åŠŸèƒ½éªŒè¯æŠ¥å‘Š</h1>
            <div id="test-status" class="test-result info">
                <div class="summary">æµ‹è¯•çŠ¶æ€ï¼šæ­£åœ¨åˆå§‹åŒ–...</div>
            </div>
        </div>
        
        <div class="section">
            <h2>æµ‹è¯•ç¯å¢ƒä¿¡æ¯</h2>
            <div class="code">
                æµ‹è¯•æ—¶é—´: <span id="test-time"></span><br>
                æµè§ˆå™¨: <span id="browser-info"></span><br>
                é¡µé¢URL: <span id="page-url"></span><br>
                ç”¨æˆ·ä»£ç†: <span id="user-agent"></span>
            </div>
        </div>
        
        <div class="section">
            <h2>æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•ç»“æœ</h2>
            <div class="test-grid">
                <div class="test-card">
                    <h4>ğŸ¯ TaskSubmissionå¯¹è±¡</h4>
                    <div id="test-tasksubmission" class="test-result warning">ç­‰å¾…æµ‹è¯•...</div>
                </div>
                
                <div class="test-card">
                    <h4>ğŸ”„ åˆå§‹åŒ–åŠŸèƒ½</h4>
                    <div id="test-init" class="test-result warning">ç­‰å¾…æµ‹è¯•...</div>
                </div>
                
                <div class="test-card">
                    <h4>ğŸ‘¥ å‘˜å·¥æ•°æ®åŠ è½½</h4>
                    <div id="test-employees" class="test-result warning">ç­‰å¾…æµ‹è¯•...</div>
                </div>
                
                <div class="test-card">
                    <h4>ğŸ“‹ ä»»åŠ¡æ•°æ®åŠ è½½</h4>
                    <div id="test-tasks" class="test-result warning">ç­‰å¾…æµ‹è¯•...</div>
                </div>
                
                <div class="test-card">
                    <h4>ğŸ“ æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½</h4>
                    <div id="test-fileupload" class="test-result warning">ç­‰å¾…æµ‹è¯•...</div>
                </div>
                
                <div class="test-card">
                    <h4>ğŸ“ ä»»åŠ¡æäº¤åŠŸèƒ½</h4>
                    <div id="test-submit" class="test-result warning">ç­‰å¾…æµ‹è¯•...</div>
                </div>
            </div>
        </div>
        
        <div class="section">
            <h2>DOMå…ƒç´ æ£€æŸ¥ç»“æœ</h2>
            <div id="dom-tests" class="test-result info">
                æ­£åœ¨æ£€æŸ¥DOMå…ƒç´ ...
            </div>
        </div>
        
        <div class="section">
            <h2>äº‹ä»¶ç»‘å®šéªŒè¯</h2>
            <div id="event-tests" class="test-result info">
                æ­£åœ¨éªŒè¯äº‹ä»¶ç»‘å®š...
            </div>
        </div>
        
        <div class="section">
            <h2>é”™è¯¯å’Œå¼‚å¸¸æ•è·</h2>
            <div id="error-tests" class="test-result info">
                æ­£åœ¨ç›‘æ§é”™è¯¯...
            </div>
        </div>
        
        <div class="section">
            <h2>æµ‹è¯•æ§åˆ¶</h2>
            <div>
                <button onclick="runAllTests()">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
                <button onclick="runQuickTest()">å¿«é€Ÿæµ‹è¯•</button>
                <button onclick="clearResults()">æ¸…ç©ºç»“æœ</button>
                <button onclick="generateReport()">ç”ŸæˆæŠ¥å‘Š</button>
            </div>
        </div>
        
        <div class="section">
            <h2>è¯¦ç»†æµ‹è¯•æ—¥å¿—</h2>
            <div id="test-log" class="code" style="max-height: 300px; overflow-y: auto;">
                ç­‰å¾…æµ‹è¯•å¼€å§‹...
            </div>
        </div>
    </div>
    
    <script src="æœªå‘½å.js"></script>
    <script>
        let testResults = {
            tasksubmission: false,
            init: false,
            employees: false,
            tasks: false,
            fileupload: false,
            submit: false,
            dom: {},
            events: {},
            errors: []
        };
        
        function log(message, type = 'info') {
            const logDiv = document.getElementById('test-log');
            const timestamp = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.style.color = type === 'error' ? '#f44336' : type === 'success' ? '#4caf50' : '#d4d4d4';
            entry.textContent = `[${timestamp}] ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function updateTestResult(elementId, success, message) {
            const element = document.getElementById(elementId);
            element.className = success ? 'test-result success' : 'test-result error';
            element.textContent = message;
        }
        
        function updateTestStatus() {
            const statusDiv = document.getElementById('test-status');
            const passed = Object.values(testResults).filter(r => r === true).length;
            const total = 6; // æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•æ•°é‡
            
            if (passed === total) {
                statusDiv.className = 'test-result success';
                statusDiv.innerHTML = `<div class="summary">âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ (${passed}/${total})</div>`;
            } else if (passed > 0) {
                statusDiv.className = 'test-result warning';
                statusDiv.innerHTML = `<div class="summary">âš ï¸ éƒ¨åˆ†æµ‹è¯•é€šè¿‡ (${passed}/${total})</div>`;
            } else {
                statusDiv.className = 'test-result error';
                statusDiv.innerHTML = `<div class="summary">âŒ æµ‹è¯•å¤±è´¥ (0/${total})</div>`;
            }
        }
        
        function testTaskSubmission() {
            log('æµ‹è¯•TaskSubmissionå¯¹è±¡...');
            try {
                if (typeof TaskSubmission !== 'undefined') {
                    testResults.tasksubmission = true;
                    updateTestResult('test-tasksubmission', true, 'âœ… TaskSubmissionå¯¹è±¡å·²å®šä¹‰');
                    log('TaskSubmissionå¯¹è±¡å­˜åœ¨', 'success');
                } else {
                    testResults.tasksubmission = false;
                    updateTestResult('test-tasksubmission', false, 'âŒ TaskSubmissionå¯¹è±¡æœªå®šä¹‰');
                    log('TaskSubmissionå¯¹è±¡ä¸å­˜åœ¨', 'error');
                }
            } catch (error) {
                testResults.tasksubmission = false;
                updateTestResult('test-tasksubmission', false, `âŒ é”™è¯¯: ${error.message}`);
                log(`æµ‹è¯•TaskSubmissionå¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        function testInit() {
            log('æµ‹è¯•åˆå§‹åŒ–åŠŸèƒ½...');
            try {
                if (testResults.tasksubmission && typeof TaskSubmission.init === 'function') {
                    TaskSubmission.init();
                    testResults.init = true;
                    updateTestResult('test-init', true, 'âœ… åˆå§‹åŒ–åŠŸèƒ½æ­£å¸¸');
                    log('åˆå§‹åŒ–åŠŸèƒ½æµ‹è¯•é€šè¿‡', 'success');
                } else {
                    testResults.init = false;
                    updateTestResult('test-init', false, 'âŒ åˆå§‹åŒ–åŠŸèƒ½å¼‚å¸¸');
                    log('åˆå§‹åŒ–åŠŸèƒ½æµ‹è¯•å¤±è´¥', 'error');
                }
            } catch (error) {
                testResults.init = false;
                updateTestResult('test-init', false, `âŒ é”™è¯¯: ${error.message}`);
                log(`æµ‹è¯•åˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        function testEmployees() {
            log('æµ‹è¯•å‘˜å·¥æ•°æ®åŠ è½½...');
            try {
                if (testResults.tasksubmission && typeof TaskSubmission.loadEmployees === 'function') {
                    TaskSubmission.loadEmployees();
                    testResults.employees = true;
                    updateTestResult('test-employees', true, 'âœ… å‘˜å·¥æ•°æ®åŠ è½½åŠŸèƒ½æ­£å¸¸');
                    log('å‘˜å·¥æ•°æ®åŠ è½½åŠŸèƒ½æµ‹è¯•é€šè¿‡', 'success');
                } else {
                    testResults.employees = false;
                    updateTestResult('test-employees', false, 'âŒ å‘˜å·¥æ•°æ®åŠ è½½åŠŸèƒ½å¼‚å¸¸');
                    log('å‘˜å·¥æ•°æ®åŠ è½½åŠŸèƒ½æµ‹è¯•å¤±è´¥', 'error');
                }
            } catch (error) {
                testResults.employees = false;
                updateTestResult('test-employees', false, `âŒ é”™è¯¯: ${error.message}`);
                log(`æµ‹è¯•å‘˜å·¥æ•°æ®åŠ è½½å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        function testDOMElements() {
            log('æ£€æŸ¥DOMå…ƒç´ ...');
            const elements = [
                'submission-employee',
                'submission-task',
                'submission-attachment',
                'submission-note',
                'task-submission-form',
                'submission-btn',
                'reset-btn'
            ];
            
            let allFound = true;
            const domResults = [];
            
            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    testResults.dom[id] = true;
                    domResults.push(`âœ… ${id}`);
                    log(`DOMå…ƒç´  ${id} å­˜åœ¨`, 'success');
                } else {
                    testResults.dom[id] = false;
                    domResults.push(`âŒ ${id}`);
                    log(`DOMå…ƒç´  ${id} ä¸å­˜åœ¨`, 'error');
                    allFound = false;
                }
            });
            
            const domDiv = document.getElementById('dom-tests');
            if (allFound) {
                domDiv.className = 'test-result success';
                domDiv.innerHTML = `<strong>âœ… æ‰€æœ‰DOMå…ƒç´ éƒ½å­˜åœ¨</strong><br>${domResults.join('<br>')}`;
            } else {
                domDiv.className = 'test-result error';
                domDiv.innerHTML = `<strong>âŒ éƒ¨åˆ†DOMå…ƒç´ ç¼ºå¤±</strong><br>${domResults.join('<br>')}`;
            }
        }
        
        function testEvents() {
            log('éªŒè¯äº‹ä»¶ç»‘å®š...');
            try {
                const form = document.getElementById('task-submission-form');
                const submitBtn = document.getElementById('submission-btn');
                const resetBtn = document.getElementById('reset-btn');
                
                const eventResults = [];
                
                if (form) {
                    testResults.events.form = true;
                    eventResults.push('âœ… è¡¨å•å­˜åœ¨');
                    log('ä»»åŠ¡æäº¤è¡¨å•å­˜åœ¨', 'success');
                } else {
                    testResults.events.form = false;
                    eventResults.push('âŒ è¡¨å•ä¸å­˜åœ¨');
                    log('ä»»åŠ¡æäº¤è¡¨å•ä¸å­˜åœ¨', 'error');
                }
                
                if (submitBtn) {
                    testResults.events.submitBtn = true;
                    eventResults.push('âœ… æäº¤æŒ‰é’®å­˜åœ¨');
                    log('æäº¤æŒ‰é’®å­˜åœ¨', 'success');
                } else {
                    testResults.events.submitBtn = false;
                    eventResults.push('âŒ æäº¤æŒ‰é’®ä¸å­˜åœ¨');
                    log('æäº¤æŒ‰é’®ä¸å­˜åœ¨', 'error');
                }
                
                if (resetBtn) {
                    testResults.events.resetBtn = true;
                    eventResults.push('âœ… é‡ç½®æŒ‰é’®å­˜åœ¨');
                    log('é‡ç½®æŒ‰é’®å­˜åœ¨', 'success');
                } else {
                    testResults.events.resetBtn = false;
                    eventResults.push('âŒ é‡ç½®æŒ‰é’®ä¸å­˜åœ¨');
                    log('é‡ç½®æŒ‰é’®ä¸å­˜åœ¨', 'error');
                }
                
                const eventDiv = document.getElementById('event-tests');
                eventDiv.className = 'test-result info';
                eventDiv.innerHTML = `<strong>äº‹ä»¶ç»‘å®šçŠ¶æ€:</strong><br>${eventResults.join('<br>')}`;
                
            } catch (error) {
                log(`äº‹ä»¶éªŒè¯å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        function setupErrorHandling() {
            window.addEventListener('error', function(event) {
                testResults.errors.push({
                    message: event.message,
                    filename: event.filename,
                    lineno: event.lineno,
                    timestamp: new Date().toISOString()
                });
                log(`å…¨å±€é”™è¯¯: ${event.message} (æ–‡ä»¶: ${event.filename}, è¡Œ: ${event.lineno})`, 'error');
            });
            
            window.addEventListener('unhandledrejection', function(event) {
                testResults.errors.push({
                    message: event.reason,
                    timestamp: new Date().toISOString()
                });
                log(`æœªå¤„ç†æ‹’ç»: ${event.reason}`, 'error');
            });
        }
        
        function runAllTests() {
            log('=== å¼€å§‹è¿è¡Œæ‰€æœ‰æµ‹è¯• ===', 'info');
            
            // é‡ç½®æµ‹è¯•ç»“æœ
            testResults = {
                tasksubmission: false,
                init: false,
                employees: false,
                tasks: false,
                fileupload: false,
                submit: false,
                dom: {},
                events: {},
                errors: []
            };
            
            // è¿è¡Œæµ‹è¯•
            testTaskSubmission();
            setTimeout(() => testInit(), 500);
            setTimeout(() => testEmployees(), 1000);
            setTimeout(() => testDOMElements(), 1500);
            setTimeout(() => testEvents(), 2000);
            
            setTimeout(() => {
                updateTestStatus();
                log('=== æ‰€æœ‰æµ‹è¯•å®Œæˆ ===', 'info');
            }, 2500);
        }
        
        function runQuickTest() {
            log('=== è¿è¡Œå¿«é€Ÿæµ‹è¯• ===', 'info');
            testTaskSubmission();
            setTimeout(() => testDOMElements(), 500);
            setTimeout(() => {
                updateTestStatus();
                log('=== å¿«é€Ÿæµ‹è¯•å®Œæˆ ===', 'info');
            }, 1000);
        }
        
        function clearResults() {
            document.getElementById('test-log').innerHTML = '';
            document.getElementById('test-status').className = 'test-result info';
            document.getElementById('test-status').innerHTML = '<div class="summary">æµ‹è¯•çŠ¶æ€ï¼šç­‰å¾…å¼€å§‹...</div>';
            
            const testElements = [
                'test-tasksubmission', 'test-init', 'test-employees', 
                'test-tasks', 'test-fileupload', 'test-submit',
                'dom-tests', 'event-tests', 'error-tests'
            ];
            
            testElements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.className = 'test-result warning';
                    element.textContent = 'ç­‰å¾…æµ‹è¯•...';
                }
            });
            
            log('ç»“æœå·²æ¸…ç©º', 'info');
        }
        
        function generateReport() {
            const report = {
                timestamp: new Date().toISOString(),
                browser: navigator.userAgent,
                url: window.location.href,
                results: testResults,
                summary: {
                    totalTests: 6,
                    passedTests: Object.values(testResults).filter(r => r === true).length,
                    failedTests: Object.values(testResults).filter(r => r === false).length,
                    errors: testResults.errors.length
                }
            };
            
            const reportStr = JSON.stringify(report, null, 2);
            log('=== ç”Ÿæˆçš„æµ‹è¯•æŠ¥å‘Š ===', 'info');
            log(reportStr, 'info');
            
            // åˆ›å»ºä¸‹è½½é“¾æ¥
            const blob = new Blob([reportStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `task-submission-test-report-${Date.now()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            log('æŠ¥å‘Šå·²ä¸‹è½½', 'success');
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', function() {
            // å¡«å……ç¯å¢ƒä¿¡æ¯
            document.getElementById('test-time').textContent = new Date().toLocaleString();
            document.getElementById('browser-info').textContent = navigator.userAgent.split(' ')[0];
            document.getElementById('page-url').textContent = window.location.href;
            document.getElementById('user-agent').textContent = navigator.userAgent;
            
            // è®¾ç½®é”™è¯¯å¤„ç†
            setupErrorHandling();
            
            // è‡ªåŠ¨è¿è¡Œå¿«é€Ÿæµ‹è¯•
            setTimeout(() => {
                runQuickTest();
            }, 1000);
        });
    </script>
</body>
</html>