<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è°ƒè¯•æ§åˆ¶å°</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .console-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .console-output {
            background-color: #1e1e1e;
            color: #ffffff;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            padding: 15px;
            border-radius: 5px;
            height: 400px;
            overflow-y: auto;
            margin: 10px 0;
        }
        .console-line {
            margin: 2px 0;
            padding: 2px 0;
        }
        .console-error { color: #ff6b6b; }
        .console-warn { color: #ffd93d; }
        .console-info { color: #6bcf7f; }
        .console-log { color: #ffffff; }
        .console-debug { color: #a8a8a8; }
        
        .controls {
            margin: 20px 0;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        .btn-primary {
            background-color: #007bff;
            color: white;
        }
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        .btn-danger {
            background-color: #dc3545;
            color: white;
        }
        
        .status-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .status-card {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }
        .status-card h3 {
            margin: 0 0 10px 0;
            color: #333;
        }
        .status-item {
            margin: 5px 0;
            padding: 5px;
            background-color: white;
            border-radius: 3px;
            font-size: 12px;
        }
        .status-success { border-left-color: #28a745; }
        .status-error { border-left-color: #dc3545; }
        .status-warning { border-left-color: #ffc107; }
    </style>
</head>
<body>
    <div class="console-container">
        <h1>ğŸ”§ è°ƒè¯•æ§åˆ¶å°</h1>
        
        <div class="controls">
            <button class="btn-primary" onclick="checkAllSystems()">å…¨é¢æ£€æŸ¥</button>
            <button class="btn-secondary" onclick="clearConsole()">æ¸…ç©ºæ§åˆ¶å°</button>
            <button class="btn-danger" onclick="testTaskSubmission()">æµ‹è¯•ä»»åŠ¡æäº¤</button>
        </div>
        
        <div class="status-panel">
            <div class="status-card">
                <h3>ğŸ¯ ä»»åŠ¡æäº¤æ¨¡å—çŠ¶æ€</h3>
                <div id="task-submission-status"></div>
            </div>
            <div class="status-card">
                <h3>ğŸ“Š æ•°æ®ç®¡ç†å™¨çŠ¶æ€</h3>
                <div id="data-manager-status"></div>
            </div>
            <div class="status-card">
                <h3>ğŸ”§ ç³»ç»Ÿç»„ä»¶çŠ¶æ€</h3>
                <div id="system-status"></div>
            </div>
        </div>
        
        <h3>ğŸ“ æ§åˆ¶å°è¾“å‡º</h3>
        <div id="console-output" class="console-output"></div>
    </div>

    <script>
        // é‡å†™consoleæ–¹æ³•ä»¥æ•è·è¾“å‡º
        const originalConsole = {
            log: console.log,
            error: console.error,
            warn: console.warn,
            info: console.info,
            debug: console.debug
        };
        
        const consoleOutput = document.getElementById('console-output');
        
        function addConsoleLine(message, type = 'log') {
            const line = document.createElement('div');
            line.className = `console-line console-${type}`;
            line.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            consoleOutput.appendChild(line);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }
        
        // é‡å†™consoleæ–¹æ³•
        console.log = function(...args) {
            addConsoleLine(args.join(' '), 'log');
            originalConsole.log.apply(console, args);
        };
        
        console.error = function(...args) {
            addConsoleLine(args.join(' '), 'error');
            originalConsole.error.apply(console, args);
        };
        
        console.warn = function(...args) {
            addConsoleLine(args.join(' '), 'warn');
            originalConsole.warn.apply(console, args);
        };
        
        console.info = function(...args) {
            addConsoleLine(args.join(' '), 'info');
            originalConsole.info.apply(console, args);
        };
        
        console.debug = function(...args) {
            addConsoleLine(args.join(' '), 'debug');
            originalConsole.debug.apply(console, args);
        };
        
        function clearConsole() {
            consoleOutput.innerHTML = '';
            addConsoleLine('æ§åˆ¶å°å·²æ¸…ç©º', 'info');
        }
        
        function addStatus(containerId, message, type = 'success') {
            const container = document.getElementById(containerId);
            const item = document.createElement('div');
            item.className = `status-item status-${type}`;
            item.textContent = message;
            container.appendChild(item);
        }
        
        function checkAllSystems() {
            clearConsole();
            addConsoleLine('å¼€å§‹å…¨é¢ç³»ç»Ÿæ£€æŸ¥...', 'info');
            
            // æ¸…ç©ºçŠ¶æ€é¢æ¿
            document.getElementById('task-submission-status').innerHTML = '';
            document.getElementById('data-manager-status').innerHTML = '';
            document.getElementById('system-status').innerHTML = '';
            
            // æ£€æŸ¥ä»»åŠ¡æäº¤æ¨¡å—
            addConsoleLine('æ£€æŸ¥ä»»åŠ¡æäº¤æ¨¡å—...', 'info');
            if (typeof TaskSubmission === 'undefined') {
                addConsoleLine('âŒ TaskSubmission å¯¹è±¡æœªå®šä¹‰', 'error');
                addStatus('task-submission-status', 'TaskSubmission å¯¹è±¡æœªå®šä¹‰', 'error');
            } else {
                addConsoleLine('âœ… TaskSubmission å¯¹è±¡å·²å®šä¹‰', 'success');
                addStatus('task-submission-status', 'TaskSubmission å¯¹è±¡å·²å®šä¹‰', 'success');
                
                const methods = ['init', 'bindEvents', 'loadEmployees', 'loadEmployeeTasks', 'submitTask'];
                methods.forEach(method => {
                    if (typeof TaskSubmission[method] === 'function') {
                        addConsoleLine(`âœ… ${method} æ–¹æ³•å­˜åœ¨`, 'success');
                        addStatus('task-submission-status', `${method} æ–¹æ³•å­˜åœ¨`, 'success');
                    } else {
                        addConsoleLine(`âŒ ${method} æ–¹æ³•ä¸å­˜åœ¨`, 'error');
                        addStatus('task-submission-status', `${method} æ–¹æ³•ä¸å­˜åœ¨`, 'error');
                    }
                });
            }
            
            // æ£€æŸ¥æ•°æ®ç®¡ç†å™¨
            addConsoleLine('æ£€æŸ¥æ•°æ®ç®¡ç†å™¨...', 'info');
            if (typeof DataManager === 'undefined') {
                addConsoleLine('âŒ DataManager æœªå®šä¹‰', 'error');
                addStatus('data-manager-status', 'DataManager æœªå®šä¹‰', 'error');
            } else {
                addConsoleLine('âœ… DataManager å·²å®šä¹‰', 'success');
                addStatus('data-manager-status', 'DataManager å·²å®šä¹‰', 'success');
                
                try {
                    const employees = DataManager.getEmployees();
                    const tasks = DataManager.getTasks();
                    addConsoleLine(`âœ… å‘˜å·¥æ•°é‡: ${employees.length}`, 'success');
                    addConsoleLine(`âœ… ä»»åŠ¡æ•°é‡: ${tasks.length}`, 'success');
                    addStatus('data-manager-status', `å‘˜å·¥: ${employees.length}, ä»»åŠ¡: ${tasks.length}`, 'success');
                } catch (error) {
                    addConsoleLine(`âŒ æ•°æ®ç®¡ç†å™¨é”™è¯¯: ${error.message}`, 'error');
                    addStatus('data-manager-status', `é”™è¯¯: ${error.message}`, 'error');
                }
            }
            
            // æ£€æŸ¥ç³»ç»Ÿç»„ä»¶
            addConsoleLine('æ£€æŸ¥ç³»ç»Ÿç»„ä»¶...', 'info');
            const components = ['Renderer', 'EventHandler', 'Statistics', 'PointsStatistics'];
            components.forEach(component => {
                if (typeof window[component] !== 'undefined') {
                    addConsoleLine(`âœ… ${component} å·²å®šä¹‰`, 'success');
                    addStatus('system-status', `${component} å·²å®šä¹‰`, 'success');
                } else {
                    addConsoleLine(`âŒ ${component} æœªå®šä¹‰`, 'error');
                    addStatus('system-status', `${component} æœªå®šä¹‰`, 'error');
                }
            });
            
            // æ£€æŸ¥é¡µé¢å…ƒç´ 
            addConsoleLine('æ£€æŸ¥é¡µé¢å…ƒç´ ...', 'info');
            const elements = [
                'task-submission',
                'task-submission-form',
                'submission-employee',
                'submission-task',
                'submission-attachment',
                'submission-note',
                'submission-uploaded-files'
            ];
            
            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    addConsoleLine(`âœ… ${id} å…ƒç´ å­˜åœ¨`, 'success');
                    addStatus('system-status', `${id} å…ƒç´ å­˜åœ¨`, 'success');
                } else {
                    addConsoleLine(`âŒ ${id} å…ƒç´ ä¸å­˜åœ¨`, 'error');
                    addStatus('system-status', `${id} å…ƒç´ ä¸å­˜åœ¨`, 'error');
                }
            });
            
            addConsoleLine('ç³»ç»Ÿæ£€æŸ¥å®Œæˆ', 'info');
        }
        
        function testTaskSubmission() {
            addConsoleLine('å¼€å§‹æµ‹è¯•ä»»åŠ¡æäº¤åŠŸèƒ½...', 'info');
            
            if (typeof TaskSubmission === 'undefined') {
                addConsoleLine('âŒ TaskSubmission æœªå®šä¹‰ï¼Œæ— æ³•æµ‹è¯•', 'error');
                return;
            }
            
            try {
                // æµ‹è¯•åˆå§‹åŒ–
                addConsoleLine('æµ‹è¯• TaskSubmission.init()...', 'info');
                TaskSubmission.init();
                addConsoleLine('âœ… TaskSubmission.init() æ‰§è¡ŒæˆåŠŸ', 'success');
                
                // æµ‹è¯•åŠ è½½å‘˜å·¥
                addConsoleLine('æµ‹è¯• TaskSubmission.loadEmployees()...', 'info');
                TaskSubmission.loadEmployees();
                addConsoleLine('âœ… TaskSubmission.loadEmployees() æ‰§è¡ŒæˆåŠŸ', 'success');
                
                addConsoleLine('ä»»åŠ¡æäº¤åŠŸèƒ½æµ‹è¯•å®Œæˆ', 'success');
            } catch (error) {
                addConsoleLine(`âŒ æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æ£€æŸ¥
        window.addEventListener('load', () => {
            setTimeout(() => {
                addConsoleLine('è°ƒè¯•æ§åˆ¶å°å·²åŠ è½½', 'info');
                checkAllSystems();
            }, 1000);
        });
        
        // æ•è·å…¨å±€é”™è¯¯
        window.addEventListener('error', (event) => {
            addConsoleLine(`âŒ å…¨å±€é”™è¯¯: ${event.message} at ${event.filename}:${event.lineno}:${event.colno}`, 'error');
        });
        
        // æ•è·æœªå¤„ç†çš„Promiseæ‹’ç»
        window.addEventListener('unhandledrejection', (event) => {
            addConsoleLine(`âŒ æœªå¤„ç†çš„Promiseæ‹’ç»: ${event.reason}`, 'error');
        });
    </script>
</body>
</html>